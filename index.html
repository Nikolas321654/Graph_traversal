<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <title>Обхід графа: BFS і DFS</title>
    <script src="https://unpkg.com/cytoscape@3.24.0/dist/cytoscape.min.js"></script>
    <style>
      body {
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      h1 {
        margin-bottom: 20px;
      }
      .graph-container {
        display: flex;
        justify-content: center;
        gap: 50px;
        margin-top: 20px;
      }
      .graph-box {
        border: 1px solid #ccc;
        width: 500px;
        height: 500px;
      }
      button {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Обхід графа: BFS DFS</h1>

    <div class="graph-container">
      <div>
        <div id="bfsGraph" class="graph-box"></div>
        <button onclick="runBFS()">Почати BFS</button>
      </div>
      <div>
        <div id="dfsGraph" class="graph-box"></div>
        <button onclick="runDFS()">Почати DFS</button>
      </div>
    </div>

    <script>
      class Graph {
        constructor() {
          this.matrix = [];
          this.seed = 4401;
          this.m = 2 ** 32;
          this.k = 0.845;
        }

        random() {
          this.seed = (1103515245 * this.seed + 12345) % this.m;
          return (this.seed / this.m) * 2;
        }

        matrixGenerate(size = 10) {
          this.matrix = [];
          for (let i = 0; i < size; i++) {
            const row = [];
            for (let j = 0; j < size; j++) {
              let val = this.random() * this.k;
              row.push(val < 1 ? 0 : 1);
            }
            this.matrix.push(row);
          }
        }

        findStart() {
          for (let i = 0; i < this.matrix.length; i++) {
            if (this.matrix[i].some((v) => v === 1)) return i;
          }
          return 0;
        }

        getTraversalSteps(type = 'BFS') {
          const visited = new Set();
          const steps = [];
          const structure = [this.findStart()];
          const isDFS = type === 'DFS';

          while (structure.length > 0) {
            const node = isDFS ? structure.pop() : structure.shift();
            if (!visited.has(node)) {
              visited.add(node);
              steps.push({ type: 'visit', node });

              for (
                let neighbor = 0;
                neighbor < this.matrix.length;
                neighbor++
              ) {
                if (
                  this.matrix[node][neighbor] === 1 &&
                  !visited.has(neighbor)
                ) {
                  steps.push({ type: 'tree-edge', from: node, to: neighbor });
                  isDFS ? structure.push(neighbor) : structure.push(neighbor);
                }
              }
            }
          }

          return steps;
        }
      }

      function createElementsFromMatrix(matrix) {
        const elements = [];
        for (let i = 0; i < matrix.length; i++) {
          elements.push({ data: { id: '' + i } });
        }
        for (let i = 0; i < matrix.length; i++) {
          for (let j = 0; j < matrix.length; j++) {
            if (matrix[i][j] === 1) {
              elements.push({
                data: { id: `${i}-${j}`, source: '' + i, target: '' + j },
              });
            }
          }
        }
        return elements;
      }

      const graph = new Graph();
      graph.matrixGenerate(10); // 10 вершин

      const bfsGraph = cytoscape({
        container: document.getElementById('bfsGraph'),
        elements: createElementsFromMatrix(graph.matrix),
        style: [
          {
            selector: 'node',
            style: {
              label: 'data(id)',
              'background-color': '#666',
              color: '#fff',
            },
          },
          {
            selector: 'edge',
            style: {
              width: 2,
              'line-color': '#ccc',
              'target-arrow-shape': 'triangle',
            },
          },
        ],
        layout: { name: 'circle' },
      });

      const dfsGraph = cytoscape({
        container: document.getElementById('dfsGraph'),
        elements: createElementsFromMatrix(graph.matrix),
        style: [
          {
            selector: 'node',
            style: {
              label: 'data(id)',
              'background-color': '#666',
              color: '#fff',
            },
          },
          {
            selector: 'edge',
            style: {
              width: 2,
              'line-color': '#ccc',
              'target-arrow-shape': 'triangle',
            },
          },
        ],
        layout: { name: 'circle' },
      });

      function runBFS() {
        const steps = graph.getTraversalSteps('BFS');
        let index = 0;

        function step() {
          if (index >= steps.length) return;
          const action = steps[index++];
          if (action.type === 'visit') {
            bfsGraph
              .getElementById('' + action.node)
              .style('background-color', 'orange');
          }
          setTimeout(step, 500);
        }

        step();
      }

      function runDFS() {
        const steps = graph.getTraversalSteps('DFS');
        let index = 0;

        function step() {
          if (index >= steps.length) return;
          const action = steps[index++];
          if (action.type === 'visit') {
            dfsGraph
              .getElementById('' + action.node)
              .style('background-color', 'green');
          }
          setTimeout(step, 500);
        }

        step();
      }
    </script>
  </body>
</html>
